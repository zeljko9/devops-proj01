#cloud-config
package_update: true
packages:
  - docker.io
  - docker-compose
  - ansible
  - wget
  - curl
  - openssh-server
runcmd:
  - systemctl enable docker
  - systemctl start docker
  - systemctl enable ssh
  - systemctl start ssh

  - usermod -aG sudo devops
  - usermod -aG docker devops
  - echo "devops ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/devops
  - chmod 440 /etc/sudoers.d/devops
  - chown root:root /etc/sudoers.d/devops
  - sudo reboot

  - sudo apt-get update
  - sudo apt-get install ca-certificates curl gnupg
  - sudo install -m 0755 -d /etc/apt/keyrings
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
  - echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
  - sudo apt-get update
  - sudo apt-get install docker-compose-plugin
